# מדריך מערכת ניהול Admin - SaveDay Events

## 🎉 המערכת הושלמה בהצלחה!

מערכת המנהל נבנתה עם **אבטחה מקסימלית** ו**אימות דו-שלבי** (Two-Factor Authentication).

---

## 🔒 תכונות אבטחה

### 1. אימות דו-שלבי מלא
- **שלב 1**: התחברות עם Email + Password
- **שלב 2**: קוד אימות 6 ספרות נשלח למייל
- הקוד תקף ל-**15 דקות** בלבד

### 2. הגנות נוספות
- ✅ הצפנת סיסמאות (Bcrypt)
- ✅ אימות מייל חובה
- ✅ בדיקת הרשאות בכל פעולה
- ✅ Session validation מול הבקאנד
- ✅ רק משתמשים עם `is_admin=TRUE` יכולים להיכנס

### 3. הגבלת גישה
- **רק המנהל** יכול להתחבר עם פרטי הכניסה הייחודיים
- משתמשים רגילים **לא יכולים** לגשת לדף המנהל גם אם ינסו להזין את ה-URL
- בדיקת הרשאות **בצד שרת** וגם **בצד לקוח**

---

## 🚀 שלבי התקנה ושימוש

### שלב 1: הכנת המסד נתונים
הרץ את הסקריפט להוספת עמודות Admin:

```bash
cd backend
python add_admin_columns.py
```

**תוצאה צפויה**:
```
All admin columns added/verified successfully!
```

---

### שלב 2: יצירת משתמש מנהל ראשון

הרץ את הסקריפט ליצירת המנהל:

```bash
python create_admin_user.py
```

**תתבקש להזין**:
- כתובת Email
- סיסמה (לפחות 8 תווים)
- שם מלא

**דוגמה**:
```
Email address: admin@saveday.com
Password (min 8 characters): Admin12345!
Full name: מנהל ראשי
```

**תוצאה**:
```
============================================================
SUCCESS! Admin user created:
============================================================
ID:         1
Email:      admin@saveday.com
Name:       מנהל ראשי
Role:       admin
Verified:   Yes (email verified automatically)
============================================================

You can now login at: http://localhost:5173/admin/login

IMPORTANT: Keep your credentials safe!
============================================================
```

---

### שלב 3: התחברות למערכת

1. **פתח דפדפן** וגש ל:
   ```
   http://localhost:5173/admin/login
   ```

2. **הזן פרטי כניסה**:
   - Email: הכתובת שהזנת
   - Password: הסיסמה שהזנת

3. **קבל קוד אימות**:
   - לחץ "המשך לאימות"
   - קוד בן 6 ספרות נשלח למייל שלך
   - **בדוק את תיבת הדואר!**

4. **הזן את הקוד**:
   - העתק את הקוד מהמייל
   - הדבק בשדה "קוד אימות"
   - לחץ "התחבר"

5. **ברוך הבא לדשבורד!** 🎉
   - תועבר אוטומטית ל: `http://localhost:5173/admin/dashboard`

---

## 📧 מראה המייל שנשלח

המייל נשלח עם עיצוב מלא ב-RTL בעברית:

```
🔐 אימות התחברות מנהל

שלום [שם המנהל],

זוהתה ניסיון התחברות לחשבון המנהל שלך ב-SaveDay Events.
לביטחונך, נדרש קוד אימות נוסף להשלמת ההתחברות.

┌─────────────────┐
│   קוד האימות:  │
│    ──────       │
│    123456       │
└─────────────────┘

⚠️ אזהרת אבטחה:
הקוד תקף ל-15 דקות בלבד.
אם לא ביקשת להתחבר כמנהל, אל תשתף קוד זה עם אף אחד
ושנה את הסיסמה שלך באופן מיידי.
```

---

## 🗂️ קבצים שנוצרו

### Backend (Python):

1. **`backend/add_admin_columns.py`**
   - מוסיף עמודות למסד הנתונים:
     - `is_admin` (BOOLEAN)
     - `role` (TEXT)
     - `admin_verification_code` (TEXT)
     - `admin_verification_expires` (TIMESTAMP)

2. **`backend/admin_auth.py`**
   - Router של FastAPI לאימות מנהל
   - Endpoints:
     - `POST /api/admin/login` - שלב 1: שליחת קוד
     - `POST /api/admin/verify-code` - שלב 2: אימות קוד
     - `GET /api/admin/check-session` - בדיקת סטטוס

3. **`backend/email_service.py`** (עודכן)
   - פונקציה חדשה: `send_admin_verification_code_email()`
   - שולחת מייל מעוצב עם קוד אימות

4. **`backend/create_admin_user.py`**
   - סקריפט ליצירת מנהל ראשון
   - אינטראקטיבי - מבקש פרטים מהמשתמש

5. **`backend/main.py`** (עודכן)
   - מחבר את `admin_auth_router` לאפליקציה

### Frontend (React):

1. **`frontend/src/pages/AdminLogin.jsx`**
   - דף התחברות מנהל
   - אימות דו-שלבי
   - טיפול בשגיאות
   - אפשרות לשלוח קוד חדש

2. **`frontend/src/pages/AdminDashboard.jsx`**
   - דשבורד מנהל
   - סטטיסטיקות (placeholder)
   - פעולות מהירות (בקרוב)
   - בדיקת הרשאות אוטומטית

3. **`frontend/src/styles/AdminLogin.css`**
   - עיצוב מודרני ומקצועי
   - אנימציות
   - Responsive Design

4. **`frontend/src/styles/AdminDashboard.css`**
   - עיצוב פאנל ניהול
   - כרטיסים אינטראקטיביים
   - Grid layout

5. **`frontend/src/main.jsx`** (עודכן)
   - נתיבים חדשים:
     - `/admin/login`
     - `/admin/dashboard`

---

## 🎨 עיצוב המערכת

### דף התחברות
- רקע גראדיאנט כהה (Navy Blue)
- תיבת התחברות לבנה מרחפת
- אייקון מנעול מונפש 🔐
- התראות מעוצבות (הצלחה/שגיאה)
- כפתור "חזור לאתר" שקוף

### דשבורד
- Header שחור עם לוגו 👑
- כרטיסי סטטיסטיקות צבעוניים
- כפתורי פעולות מהירות (בקרוב)
- עיצוב Responsive מלא

---

## 🔐 אבטחה - שאלות נפוצות

### Q: האם משתמש רגיל יכול לגשת לדף המנהל?
**A**: לא! גם אם ינסה להזין את ה-URL `/admin/dashboard`, הוא יועבר חזרה ל-`/admin/login` מכיוון שאין לו `is_admin=TRUE`.

### Q: מה קורה אם הקוד פג תוקף?
**A**: ניתן ללחוץ על "שלח קוד חדש" ולקבל קוד חדש למייל.

### Q: האם הסיסמה מוצפנת?
**A**: כן! הסיסמה מוצפנת ב-**Bcrypt** עם salt אוטומטי.

### Q: האם ניתן ליצור כמה מנהלים?
**A**: כן! פשוט הרץ שוב את `create_admin_user.py` עם אימייל אחר, או שדרג משתמש קיים.

### Q: איך מבטלים הרשאות מנהל ממישהו?
**A**: הרץ SQL ישירות על הדאטבייס:
```sql
UPDATE users SET is_admin = FALSE, role = 'user' WHERE email = 'user@example.com';
```

---

## 🛠️ המשך פיתוח - תכונות עתידיות

הדשבורד מוכן להוספת תכונות כמו:

### 1. ניהול משתמשים
- צפייה בכל המשתמשים
- עריכה/מחיקה
- חסימת משתמשים
- סטטיסטיקות משתמשים

### 2. ניהול אירועים
- צפייה בכל האירועים
- מחיקת אירועים
- דוחות אירועים

### 3. ניהול חבילות
- הוספה/עריכה/מחיקה של חבילות
- שינוי מחירים
- ניהול תכונות

### 4. דוחות ואנליטיקס
- דוחות הכנסות
- גרפים ומגמות
- ייצוא ל-Excel/PDF

### 5. הגדרות מערכת
- שינוי הגדרות אימייל
- ניהול תבניות
- לוגים ומעקב

---

## 📞 תמיכה

אם נתקלת בבעיה:

1. **וודא שהשרתים רצים**:
   ```bash
   # Backend
   cd backend
   uvicorn main:app --reload

   # Frontend
   cd frontend
   npm run dev
   ```

2. **בדוק לוגים**:
   - Backend: בטרמינל שבו רץ uvicorn
   - Frontend: Developer Console בדפדפן (F12)

3. **בדוק אימייל**:
   - וודא ש-`.env` מוגדר נכון
   - בדוק ב-Spam/Junk

---

## ✅ סיכום

מערכת המנהל מוכנה לשימוש! 🎉

- ✅ מסד נתונים מוכן
- ✅ Backend API מוכן
- ✅ Frontend מוכן
- ✅ אימות דו-שלבי פועל
- ✅ מיילים נשלחים
- ✅ אבטחה מקסימלית

**הצעד הבא**: צור את המשתמש מנהל הראשון שלך והתחל לנהל את האתר!

```bash
cd backend
python create_admin_user.py
```

---

**נוצר על ידי Claude Code** 🤖
**תאריך**: 2025-01-20
